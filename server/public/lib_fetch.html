<html>
<head></head>
<body>
	<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script>
	var albums = {};

	function addTitle(track, meta) {
		// Cascading possible values for the album's artist
		var actualArtist = meta.albumartist[0] || meta.artist[0] || '(Unknown)';
		// Concatenating artist and album name to have 'unique' identifiers
		var albumID = actualArtist + '::' + meta.album;

		if(!albums[albumID]) {
			albums[albumID] = {
				name: meta.album,
				artist: actualArtist,
				year: meta.year,
				tracks: []
			};
		}

		albums[albumID].tracks.push(track);
	}

	$.ajax('/library', {success:
	function(library) {
		var startTime = new Date();

		$.each(library, function(i, entry) {
			var meta = entry.metadata;

			if(meta === undefined) {
				console.log('No metadata for', entry);
				return;
			}

			addTitle(entry, meta);
		});

		console.log(albums);
		console.log((new Date() - startTime), 'ms');
	}});
	</script>
</body>
</html>